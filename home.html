<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>TeamBuilder — Home (MVP)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #fafafa;
      --card: #fff;
      --text: #111;
      --muted: #666;
      --border: #e6e6e6;
      --primary: #4f46e5;
      --primary-contrast: #fff;
      --pill: #f4f4f5;
      --badge-bg: #ecfdf5;
      --badge-text: #065f46;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color: var(--text); background: var(--bg); }
    .topbar { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--card); border-bottom: 1px solid var(--border); }
    .brand { font-weight: 700; }
    .menu { display: flex; gap: 8px; align-items: center; }
    .link { color: var(--text); text-decoration: none; padding: 8px 10px; border-radius: 8px; }
    .link:hover { background: #f4f4f5; }
    .btn { padding: 8px 12px; border: 1px solid var(--border); border-radius: 10px; background: var(--card); cursor: pointer; }
    .btn:hover { background: #f7f7f7; }
    .btn-primary { background: var(--primary); color: var(--primary-contrast); border-color: var(--primary); }
    .btn-primary:hover { filter: brightness(0.95); }
    .btn-outline { background: var(--card); }
    .container { max-width: 1120px; margin: 0 auto; padding: 24px 16px; }
    .hero { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 24px; text-align: center; }
    .hero h1 { margin: 0 0 4px; }
    .hero p { margin: 0 0 16px; color: var(--muted); }
    .search-bar { display: grid; grid-template-columns: 1fr auto; gap: 8px; max-width: 720px; margin: 0 auto; }
    .search-bar input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; }
    .actions { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 12px; }
    .team { margin-top: 24px; }
    .team-head { display: flex; align-items: center; justify-content: space-between; }
    .badge { background: var(--badge-bg); color: var(--badge-text); border: 1px solid #a7f3d0; padding: 4px 8px; border-radius: 999px; font-size: 12px; }
    .grid { display: grid; gap: 12px; grid-template-columns: repeat(1, minmax(0, 1fr)); margin-top: 12px; }
    @media (min-width: 720px) { .grid { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 1040px){ .grid { grid-template-columns: repeat(3, 1fr); } }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; }
    .card-head { display: grid; grid-template-columns: auto 1fr auto; gap: 12px; align-items: center; }
    .avatar { width: 48px; height: 48px; border-radius: 999px; background: #e9e9ee; display: grid; place-items: center; font-weight: 700; color: var(--muted); overflow: hidden; }
    .avatar img { width: 100%; height: 100%; object-fit: cover; }
    .info .name { margin: 0; font-size: 16px; }
    .info .role { margin: 2px 0 0; font-size: 13px; color: var(--muted); }
    .info .xps { margin: 2px 0 0; font-size: 12px; color: var(--muted); }
    .status-dot { width: 10px; height: 10px; border-radius: 999px; background: #9ca3af; }
    .status-dot[data-status="online"] { background: #10b981; }
    .status-dot[data-status="busy"]   { background: #f59e0b; }
    .specialties, .skills { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; }
    .specialties .pill { display: inline-flex; align-items: center; gap: 6px; background: var(--pill); border: 1px solid var(--border); border-radius: 999px; padding: 6px 8px; font-size: 12px; }
    .specialties .dots { display: inline-flex; gap: 3px; }
    .specialties .dot { width: 6px; height: 6px; border-radius: 999px; background: #d4d4d8; }
    .specialties .dot.active { background: #6366f1; }
    .skills .tag { background: var(--pill); border: 1px solid var(--border); border-radius: 8px; padding: 4px 8px; font-size: 12px; }
    .bio { margin-top: 10px; font-size: 13px; color: var(--muted); }
    .footer { text-align: center; font-size: 12px; color: var(--muted); padding: 24px; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">TeamBuilder</div>
    <nav class="menu">
      <a href="#" class="link">Perfil</a>
      <a href="#" class="link">Meus Projetos</a>
      <a href="./Criar_projeto/criar_projeto.html" class="btn btn-primary">Nova Ideia</a>
    </nav>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Encontre Sua Equipe</h1>
      <p>Busque colaboradores por habilidades, experiência ou localização.</p>
      <div class="search-bar">
        <input id="searchInput" type="search" placeholder="Ex.: React, DevOps, São Paulo..." />
        <button id="searchBtn" class="btn">Buscar</button>
      </div>
      <div class="actions">
        <button class="btn btn-outline" id="addMemberBtn">+ Adicionar Colaborador</button>
        <button class="btn btn-outline">Explorar Equipes</button>
        <button class="btn btn-outline">Filtros Avançados</button>
      </div>
    </section>

    <section class="team">
      <div class="team-head">
        <h2>Sua Equipe</h2>
        <span id="teamCount" class="badge">0 colaboradores</span>
      </div>

      <div id="teamGrid" class="grid"></div>

      <template id="memberCardTpl">
        <article class="card">
          <div class="card-head">
            <div class="avatar" data-initials=""></div>
            <div class="info">
              <h3 class="name"></h3>
              <p class="role"></p>
              <p class="xps"></p>
            </div>
            <span class="status-dot"></span>
          </div>
          <div class="specialties"></div>
          <div class="skills"></div>
          <p class="bio"></p>
        </article>
      </template>
    </section>
  </main>

  <footer class="footer">© <span id="year"></span> TeamBuilder</footer>

  <script>
    const apiUrl = "/api/team"; // ajuste se necessário
    const teamGrid = document.getElementById("teamGrid");
    const teamCount = document.getElementById("teamCount");
    const tpl = document.getElementById("memberCardTpl");
    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");
    document.getElementById("year").textContent = new Date().getFullYear();

    let members = [];

    function initials(name = "") {
      return name.split(" ").map(s => s[0]?.toUpperCase() || "").slice(0,2).join("");
    }

    function normalizeApiTeamResponse(data) {
      if (!Array.isArray(data)) return [];
      return data.map((row, idx) => ({
        id: String(row.id ?? idx),
        name: row.name ?? row.nome ?? "Membro",
        role: row.role ?? row.cargo ?? "Colaborador",
        experienceYears: row.experienceYears ?? row.anosExperiencia ?? null,
        avatarUrl: row.avatarUrl ?? row.fotoUrl ?? null,
        status: row.status ?? "offline",
        specialties: (row.specialties ?? row.especialidades ?? []).map(s => ({
          code: String(s.code ?? s.sigla ?? "SP"),
          label: String(s.label ?? s.nome ?? "Especialidade"),
          level: Number(s.level ?? s.nivel ?? 3)
        })),
        skills: (row.skills ?? row.habilidades ?? []).map(String),
        bio: row.bio ?? row.descricao ?? ""
      }));
    }

    function render(list) {
      teamGrid.innerHTML = "";
      list.forEach(m => {
        const node = tpl.content.cloneNode(true);

        const avatar = node.querySelector(".avatar");
        if (m.avatarUrl) {
          const img = document.createElement("img");
          img.src = m.avatarUrl; img.alt = m.name;
          avatar.textContent = ""; avatar.appendChild(img);
        } else {
          avatar.textContent = initials(m.name);
        }

        node.querySelector(".name").textContent = m.name;
        node.querySelector(".role").textContent = m.role;
        node.querySelector(".xps").textContent = m.experienceYears != null ? `${m.experienceYears}+ anos de experiência` : "";
        node.querySelector(".status-dot").setAttribute("data-status", m.status);

        const specs = node.querySelector(".specialties");
        m.specialties?.forEach(s => {
          const pill = document.createElement("span");
          pill.className = "pill";
          pill.title = s.label;
          pill.innerHTML = `<strong>${s.code}</strong> <span class="dots">${[0,1,2,3,4].map(i => `<span class="dot ${i < s.level ? "active" : ""}"></span>`).join("")}</span>`;
          specs.appendChild(pill);
        });

        const skills = node.querySelector(".skills");
        m.skills?.forEach(t => {
          const tag = document.createElement("span");
          tag.className = "tag";
          tag.textContent = t;
          skills.appendChild(tag);
        });

        node.querySelector(".bio").textContent = m.bio ?? "";
        teamGrid.appendChild(node);
      });
      teamCount.textContent = `${list.length} colaborador${list.length === 1 ? "" : "es"}`;
    }

    async function load() {
      try {
        const res = await fetch(apiUrl, { headers: { "Content-Type": "application/json" }});
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        members = normalizeApiTeamResponse(data);
      } catch (e) {
        members = [
          { id:"1", name:"Sarah Chen", role:"Full Stack", experienceYears:5, avatarUrl:null, status:"online", specialties:[{code:"FR", label:"Frontend", level:4}], skills:["React","TS"], bio:"" },
          { id:"2", name:"Marcus Johnson", role:"DevOps", experienceYears:7, avatarUrl:null, status:"busy", specialties:[{code:"NU", label:"Nuvem", level:3}], skills:["Docker","K8s"], bio:"" }
        ];
      }
      render(members);
    }

    function doSearch() {
      const q = (searchInput.value || "").toLowerCase();
      if (!q) return render(members);
      const filtered = members.filter(m =>
        m.name.toLowerCase().includes(q) ||
        m.role.toLowerCase().includes(q) ||
        (m.bio || "").toLowerCase().includes(q) ||
        m.skills?.some(s => s.toLowerCase().includes(q)) ||
        m.specialties?.some(s => s.label.toLowerCase().includes(q) || s.code.toLowerCase().includes(q))
      );
      render(filtered);
    }

    searchBtn.addEventListener("click", doSearch);
    searchInput.addEventListener("keyup", (e) => { if (e.key === "Enter") doSearch(); });

    load();
  </script>
</body>
</html>
